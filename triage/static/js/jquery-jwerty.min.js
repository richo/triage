/*
 * jwerty - Awesome handling of keyboard events
 *
 * jwerty is a JS lib which allows you to bind, fire and assert key combination
 * strings against elements and events. It normalises the poor std api into
 * something easy to use and clear.
 *
 * This code is licensed under the MIT
 * For the full license see: http://keithamus.mit-license.org/
 * For more information see: http://keithamus.github.com/jwerty
 *
 * @author Keith Cirkel ('keithamus') <jwerty@keithcirkel.co.uk>
 * @license http://keithamus.mit-license.org/
 * @copyright Copyright © 2011, Keith Cirkel
 *
 */
(function(a,b){function l(a){var b,c,d,e,f,g,k,m,n;if(a instanceof l)return a;if(!h(a,"array")){a=String(a).replace(/\s/g,"").toLowerCase().match(/(?:\+,|[^,])+/g)}for(b=0,c=a.length;b<c;++b){if(!h(a[b],"array")){a[b]=String(a[b]).match(/(?:\+\/|[^\/])+/g)}g=[],d=a[b].length;while(d--){var k=a[b][d];f={jwertyCombo:String(k),shiftKey:false,ctrlKey:false,altKey:false,metaKey:false};if(!h(k,"array")){k=String(k).toLowerCase().match(/(?:(?:[^\+])+|\+\+|^\+$)/g)}e=k.length;while(e--){if(k[e]==="++")k[e]="+";if(k[e]in j.mods){f[i[j.mods[k[e]]]]=true}else if(k[e]in j.keys){f.keyCode=j.keys[k[e]]}else{m=k[e].match(/^\[([^-]+\-?[^-]*)-([^-]+\-?[^-]*)\]$/)}}if(h(f.keyCode,"undefined")){if(m&&m[1]in j.keys&&m[2]in j.keys){m[2]=j.keys[m[2]];m[1]=j.keys[m[1]];for(n=m[1];n<m[2];++n){g.push({altKey:f.altKey,shiftKey:f.shiftKey,metaKey:f.metaKey,ctrlKey:f.ctrlKey,keyCode:n,jwertyCombo:String(k)})}f.keyCode=n}else{f.keyCode=0}}g.push(f)}this[b]=g}this.length=b;return this}function h(a,b){return a===null?b==="null":a===undefined?b==="undefined":a.is&&a instanceof d?b==="element":Object.prototype.toString.call(a).toLowerCase().indexOf(b)>7}var c=a.document,d=a.jQuery||a.Zepto||a.ender||c,e,f,g="keydown";if(d===c){e=function(a,b){return a?d.querySelector(a,b||d):d};f=function(a,b){a.addEventListener(g,b,false)};$f=function(a,b){var c=document.createEvent("Event"),e;c.initEvent(g,true,true);for(e in b)c[e]=b[e];return(a||d).dispatchEvent(c)}}else{e=function(a,b,e){return d(a||c,b)};f=function(a,b){d(a).bind(g+".jwerty",b)};$f=function(a,b){d(a||c).trigger(d.Event(g,b))}}var i={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"};var j={mods:{"⇧":16,shift:16,"⌃":17,ctrl:17,"⌥":18,alt:18,option:18,"⌘":91,meta:91,cmd:91,"super":91,win:91},keys:{"⌫":8,backspace:8,"⇥":9,"⇆":9,tab:9,"↩":13,"return":13,enter:13,"⌅":13,pause:19,"pause-break":19,"⇪":20,caps:20,"caps-lock":20,"⎋":27,escape:27,esc:27,space:32,"↖":33,pgup:33,"page-up":33,"↘":34,pgdown:34,"page-down":34,"⇟":35,end:35,"⇞":36,home:36,ins:45,insert:45,del:45,"delete":45,"←":37,left:37,"arrow-left":37,"↑":38,up:38,"arrow-up":38,"→":39,right:39,"arrow-right":39,"↓":40,down:40,"arrow-down":40,"*":106,star:106,asterisk:106,multiply:106,"+":107,plus:107,"-":109,subtract:109,"=":187,equals:187,",":188,comma:188,".":190,period:190,"full-stop":190,"/":191,slash:191,"forward-slash":191,"`":192,tick:192,"back-quote":192,"[":219,"open-bracket":219,"\\":220,"back-slash":220,"]":221,"close-bracket":221,"'":222,quote:222,apostraphe:222}};k=95,n=0;while(++k<106){j.keys["num-"+n]=k;++n}k=47,n=0;while(++k<58){j.keys[n]=k;++n}k=111,n=1;while(++k<136){j.keys["f"+n]=k;++n}var k=64;while(++k<91){j.keys[String.fromCharCode(k).toLowerCase()]=k}var m=b.jwerty={event:function(a,b,c){if(h(b,"boolean")){var d=b;b=function(){return d}}a=new l(a);var e=0,f=a.length-1,g,i;return function(d){if(i=m.is(a,d,e)){if(e<f){++e;return}else{g=b.call(c||this,d,i);if(g===false)d.preventDefault();e=0;return}}e=m.is(a,d)?1:0}},is:function(a,b,c){a=new l(a);c=c||0;a=a[c];b=b.originalEvent||b;var d,e=a.length,f=false;while(e--){f=a[e].jwertyCombo;for(var g in a[e]){if(g!=="jwertyCombo"&&b[g]!=a[e][g])f=false}if(f!==false)return f}return f},key:function(b,c,d,g,i){var j=h(d,"element")||h(d,"string")?d:g,k=j===d?a:d,l=j===d?g:i;f(h(j,"element")?j:e(j,l),m.event(b,c,k))},fire:function(a,b,c,d){a=new l(a);var f=h(c,"number")?c:d;$f(h(b,"element")?b:e(b,c),a[f||0][0])},KEYS:j}})(this,typeof module!=="undefined"&&module.exports?module.exports:this)
